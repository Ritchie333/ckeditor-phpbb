CKEDITOR.plugins.add("imgur",{lang:["zh","en","es"],icons:"imgur",hidpi:!0,init:function(d){var u,g=d.config.imgurClientId;g?(u=$("<div></div>").css({position:"absolute",bottom:0,left:0,right:0,backgroundColor:"rgba(20, 20, 20, .6)",padding:5,color:"#fff"}).hide(),d.on("instanceReady",function(){var a=$(d.window.getFrame().$).parent();a.css({position:"relative"}),u.appendTo(a)}),d.ui.addButton("Imgur",{label:"Imgur",toolbar:"insert",command:"imgur-uploader"}),d.addCommand("imgur-uploader",{exec:function(){var a=$('<input type="file" multiple />');a.on("change",function(a){var a=a.target.files,l=a.length;u.text(l+d.lang.imgur.uploading).fadeIn(),$.each(a,function(a,e){var n,i,t,o,r;n=a,i=e,t=l,a=g,o=u,r=d,(e=new FormData).append("image",i),$.ajax({url:"https://api.imgur.com/3/image",headers:{Authorization:"Client-ID "+a},type:"POST",processData:!1,data:e,cache:!1,contentType:!1}).done(function(a){a='<img src="'+a.data.link+'"/>',a=CKEDITOR.dom.element.createFromHtml(a);r.insertElement(a)}).fail(function(a){a=$.parseJSON(a.responseText);alert(r.lang.imgur.failToUpload+a.data.error)}).always(function(){t===n+1&&o.fadeOut()})})}),a.click()}})):alert(d.lang.imgur.clientIdMissing)}});
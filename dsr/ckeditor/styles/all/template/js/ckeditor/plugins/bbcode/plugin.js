CKEDITOR.config.bbcode_bbcodeMap={b:"strong",u:"u",i:"em",s:"s",color:"span",size:"span",left:"div",right:"div",center:"div",justify:"div",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},CKEDITOR.config.bbcode_convertMap={strong:"b",b:"b",u:"u",em:"i",i:"i",s:"s",code:"code",li:"*"},CKEDITOR.config.bbcode_tagnameMap={strong:"b",em:"i",u:"u",s:"s",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},CKEDITOR.config.bbcode_stylesMap={color:"color",size:"font-size",left:"text-align",center:"text-align",right:"text-align",justify:"text-align"},CKEDITOR.config.bbcode_attributesMap={url:"href",email:"mailhref",quote:"cite",list:"listType"},CKEDITOR.config.bbcode_smileyMap={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},function(){CKEDITOR.on("dialogDefinition",function(e){var t,n=e.data.name,e=e.data.definition;"link"==n?(e.removeContents("target"),e.removeContents("upload"),e.removeContents("advanced"),(t=e.getContents("info")).remove("emailSubject"),t.remove("emailBody")):"image"==n&&(e.removeContents("advanced"),(t=e.getContents("Link")).remove("cmbTarget"),(t=e.getContents("info")).remove("txtAlt"),t.remove("basic"))});var l={},d={},h={},c={},u={},e=CKEDITOR.dtd,m=CKEDITOR.tools.extend({table:1},e.$block,e.$listItem,e.$tableContent,e.$list),b={},i={},p=[],n=function(){var e,t=[],n={nbsp:" ",shy:"­"};for(e in n)t.push(e);return t=new RegExp("&("+t.join("|")+");","g"),function(e){return e.replace(t,function(e,t){return n[t]})}}();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/gi}},CKEDITOR.BBCodeParser.prototype={parse:function(e){for(var t,n,r=0;t=this._.bbcPartsRegex.exec(e);){var i,a,s,o=t.index;r<o&&(s=e.substring(r,o),this.onText(s,1)),r=this._.bbcPartsRegex.lastIndex,!(n=(t[1]||t[3]||"").toLowerCase())||l[n]?t[1]?(i=l[n],a={},o={},s=t[2],"left"!=n&&"right"!=n&&"center"!=n&&"justify"!=n||(s=n),s&&("list"==n&&(isNaN(s)?/^[a-z]+$/.test(s)?s="lower-alpha":/^[A-Z]+$/.test(s)&&(s="upper-alpha"):s="decimal"),c[n]?("size"==n&&(s+="%"),o[c[n]]=s,a.style=function(e){var t,n="",r=/\s*(?:;\s*|$)/;for(t in e)n+=(t+":"+e[t]).replace(r,";");return n}(o)):u[n]&&(a[u[n]]=CKEDITOR.tools.htmlDecode(s))),"email"!=n&&"img"!=n||(a.bbcode=n),this.onTagOpen(i,a,CKEDITOR.dtd.$empty[i])):t[3]&&this.onTagClose(l[n]):this.onText(t[0])}e.length>r&&this.onText(e.substring(r,e.length),1)}},CKEDITOR.htmlParser.fragment.fromBBCode=function(e){var s,o=new CKEDITOR.BBCodeParser,r=new CKEDITOR.htmlParser.fragment,l=[],a=0,c=r;function u(e){if(0<l.length)for(var t=0;t<l.length;t++){var n=l[t],r=n.name,i=CKEDITOR.dtd[r],a=c.name&&CKEDITOR.dtd[c.name];a&&!a[r]||e&&i&&!i[e]&&CKEDITOR.dtd[e]||((n=n.clone()).parent=c,c=n,l.splice(t,1),t--)}}function d(e,t){var n=c.children.length,r=0<n&&c.children[n-1],i=!r&&g.getRule(h[c.name],"breakAfterOpen"),n=r&&r.type==CKEDITOR.NODE_ELEMENT&&g.getRule(h[r.name],"breakAfterClose"),t=e&&g.getRule(h[e],t?"breakBeforeClose":"breakBeforeOpen");a&&(i||n||t)&&a--,a&&e in m&&a++;for(;a&&a--;)c.children.push(r=new CKEDITOR.htmlParser.element("br"))}function f(e,t){d(e.name,1);var n=(t=t||c||r).children.length,n=0<n&&t.children[n-1]||null;e.previous=n,(e.parent=t).children.push(e),e.returnPoint&&(c=e.returnPoint,delete e.returnPoint)}o.onTagOpen=function(e,t){var n=new CKEDITOR.htmlParser.element(e,t);if(CKEDITOR.dtd.$removeEmpty[e])l.push(n);else{var r=c.name,i=r&&(CKEDITOR.dtd[r]||(c._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span));if(i&&!i[e]){var a,i=!1;if(e==r?f(c,c.parent):i=(e in CKEDITOR.dtd.$listItem?(o.onTagOpen("ul",{}),a=c):(f(c,c.parent),l.unshift(c)),!0),c=a||c.returnPoint||c.parent,i)return void o.onTagOpen.apply(this,arguments)}u(e),d(e),n.parent=c,n.returnPoint=s,s=0,n.isEmpty?f(n):c=n}},o.onTagClose=function(e){for(var t=l.length-1;0<=t;t--)if(e==l[t].name)return void l.splice(t,1);for(var n=[],r=[],i=c;i.type&&i.name!=e;)i._.isBlockLike||r.unshift(i),n.push(i),i=i.parent;if(i.type){for(t=0;t<n.length;t++){var a=n[t];f(a,a.parent)}f(c=i,i.parent),i==c&&(c=c.parent),l=l.concat(r)}},o.onText=function(e){var t=CKEDITOR.dtd[c.name];t&&!t["#"]||(d(),u(),e.replace(/(\r\n|[\r\n])|[^\r\n]*/g,function(n,e){var r;void 0!==e&&e.length?a++:n.length&&(r=0,b&&n.replace(p,function(e,t){f(new CKEDITOR.htmlParser.text(n.substring(r,t)),c),f(new CKEDITOR.htmlParser.element("smiley",{desc:i[e]}),c),r=t+e.length}),r!=n.length&&f(new CKEDITOR.htmlParser.text(n.substring(r,n.length)),c))}))};try{o.parse(CKEDITOR.tools.htmlEncode(e))}catch(e){console.error(e)}for(;c.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT;){var t=c.parent;f(c,t),c=t}return r};var g=new(CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]},this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1}),this.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0}),this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1}),this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1})},proto:{setRules:function(e,t){var n=this._.rules[e];n?CKEDITOR.tools.extend(n,t,!0):this._.rules[e]=t},getRule:function(e,t){return this._.rules[e]&&this._.rules[e][t]},openTag:function(e){e in l&&(this.getRule(e,"breakBeforeOpen")&&this.lineBreak(1),this.write("[",e))},openTagClose:function(e){"br"==e?this._.output.push("\n"):e in l&&(this.write("]"),this.getRule(e,"breakAfterOpen")&&this.lineBreak(1))},attribute:function(e,t){"option"==e&&this.write("=",t)},closeTag:function(e){e in l&&(this.getRule(e,"breakBeforeClose")&&this.lineBreak(1),"*"!=e&&this.write("[/",e,"]"),this.getRule(e,"breakAfterClose")&&this.lineBreak(1))},text:function(e){this.write(e)},comment:function(){},lineBreak:function(){!this._.hasLineBreak&&this._.output.length&&(this.write("\n"),this._.hasLineBreak=1)},write:function(){this._.hasLineBreak=0;var e=Array.prototype.join.call(arguments,"");this._.output.push(e)},reset:function(){this._.output=[],this._.hasLineBreak=0},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),n(t)}}}));CKEDITOR.plugins.add("bbcode",{requires:"entities",beforeInit:function(e){var t=e.config;l=t.bbcode_bbcodeMap,d=t.bbcode_convertMap,h=t.bbcode_tagnameMap,c=t.bbcode_stylesMap,u=t.bbcode_attributesMap,(b=t.bbcode_smileyMap)&&function(){for(var e in b)i[b[e]]=e,p.push(b[e].replace(/\(|\)|\:|\/|\*|\-|\?|\|/g,function(e){return"\\"+e}));p=new RegExp(p.join("|"),"g")}(),CKEDITOR.tools.extend(t,{enterMode:CKEDITOR.ENTER_BR,basicEntities:!1,entities:!1,fillEmptyBlocks:!1},!0),e.filter.disable(),e.activeEnterMode=e.enterMode=CKEDITOR.ENTER_BR},init:function(u){var r=u.config;var n=new CKEDITOR.htmlParser.filter;function e(e){var t=e.data.dataValue;e.data.dataValue=(e=t,t=CKEDITOR.htmlParser.fragment.fromBBCode(e),e=new CKEDITOR.htmlParser.basicWriter,t.writeHtml(e,n),e.getHtml(!0))}n.addRules({elements:{blockquote:function(e){var t=new CKEDITOR.htmlParser.element("div");t.children=e.children,e.children=[t];var n=e.attributes.cite;n&&(0<(n=(t=n.replace(/^"|"$/g,"")).split(" ")).length&&(e.attributes["data-metadata"]=t,t=n[0]),(n=new CKEDITOR.htmlParser.element("cite")).add(new CKEDITOR.htmlParser.text(t)),delete e.attributes.cite,e.children.unshift(n))},span:function(e){var t;(t=e.attributes.bbcode)&&("img"==t?(e.name="img",e.attributes.src=e.children[0].value,e.children=[]):"email"==t&&(e.name="a",e.attributes.href="mailto:"+e.children[0].value),delete e.attributes.bbcode)},ol:function(e){e.attributes.listType?"decimal"!=e.attributes.listType&&(e.attributes.style="list-style-type:"+e.attributes.listType):e.name="ul",delete e.attributes.listType},a:function(e){e.attributes.href||(e.attributes.href=e.children[0].value)},smiley:function(e){e.name="img";var t=e.attributes.desc,n=r.smiley_images[CKEDITOR.tools.indexOf(r.smiley_descriptions,t)],n=CKEDITOR.tools.htmlEncode(r.smiley_path+n);e.attributes={src:n,"data-cke-saved-src":n,title:t,alt:t}},code:function(e){var t=e.attributes["data-cke-code-lang"];t&&(e.attributes.class="language-"+t)}}}),u.dataProcessor.htmlFilter.addRules({elements:{$:function(e){var t,n,r=e.attributes,i=CKEDITOR.tools.parseCssText(r.style,1),a=e.name;if(a in d)a=d[a];else if("span"==a)(t=i.color)?(a="color",t=CKEDITOR.tools.convertRgbToHex(t)):!(t=i["font-size"])||(n=t.match(/(\d+)%$/))&&(t=n[1],a="size");else if("ol"==a||"ul"==a){if(t=i["list-style-type"])switch(t){case"lower-alpha":t="a";break;case"upper-alpha":t="A"}else"ol"==a&&(t=1);a="list"}else if("blockquote"==a){try{var s=e.children[0],o=e.children[1],l="cite"==s.name&&s.children[0].value,s=e.attributes["data-metadata"];l&&(t=s||'"'+l+'"',e.children=o.children)}catch(e){}a="quote"}else if("a"==a)(t=r.href)&&(-1!==t.indexOf("mailto:")?(a="email",e.children=[new CKEDITOR.htmlParser.text(t.replace("mailto:",""))],t=""):((c=1==e.children.length&&e.children[0])&&c.type==CKEDITOR.NODE_TEXT&&c.value==t&&(t=""),a="url"));else if("img"==a){e.isEmpty=0;var i=r["data-cke-saved-src"]||r.src,c=r.alt;if(i&&-1!=i.indexOf(u.config.smiley_path)&&c)return new CKEDITOR.htmlParser.text(b[c]);e.children=[new CKEDITOR.htmlParser.text(i)]}else"code"!=a||(r=r["data-cke-code-lang"])&&(t=r);return e.name=a,t&&(e.attributes.option=t),null},div:function(e){var t=CKEDITOR.tools.parseCssText(e.attributes.style,1)["text-align"]||"";if(t)return e.name=t,null},br:function(e){e=e.next;if(e&&e.name in m)return!1}}},1),u.dataProcessor.writer=g,u.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?u.once("contentDom",function(){u.on("setData",e)}):u.on("setData",e)},afterInit:function(r){var e;r._.elementsPath&&(e=r._.elementsPath.filters)&&e.push(function(e){var t=e.getName(),n=h[t]||!1;return"link"==n&&0===e.getAttribute("href").indexOf("mailto:")?n="email":"span"==t?e.getStyle("font-size")?n="size":e.getStyle("color")&&(n="color"):"div"==t&&e.getStyle("text-align")?n=e.getStyle("text-align"):"img"!=n||(e=e.data("cke-saved-src")||e.getAttribute("src"))&&0===e.indexOf(r.config.smiley_path)&&(n="smiley"),n})}})}();